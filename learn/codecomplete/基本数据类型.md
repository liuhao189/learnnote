# 基本数据类型

基本数据类型是构建其它所有数据类型的构造块，本章包含了使用数，整数，浮点数，字符和字符串，布尔变量，枚举类型，具名常量以及数组的一些技巧。

## 数值概率

避免使用神秘数值，神秘数值是在程序中出现的，没有经过解释的数值文字量。具名常量或全局变量。优点：修改会变得更可靠；修改会变得更容易；代码变得更可读。

如果需要，可以使用硬编码的0和1，数值0和1用于增量，减量和从数组第一个元素开始循环。程序主体中仅能出现的文字量就是0和1，任何其它文字量都应该换成更有描述性的表示。

预防除零错误，每次使用除法符号的时候，都要考虑表达式的分组是否可能为0。

使类型转换变得明显，确认当不同数据类型之间的转换发生时，阅读你代码的人会注意到这点。不同的编译器会执行不同的转换。

避免混合类型的比较，自己动手进行类型转换。

注意编译器的警告，当你在同一表达式中使用了多种类型的数值的时候，很多现代的编译器都会通知你。

## 整数

检查整数除法，使用整数的时候，7/10不一定等于.7。

检查整数溢出，做整数乘法或加法的时候，你要留心可能的最大整数。

检查中间结果溢出。

## 浮点数

使用浮点数时主要考虑的是，很多十进制小数不能精确地用数字计算机中的1和0来表示。

避免数量级相差巨大的数之间的加减运算，必须把一系列差异如此巨大的数相加，那么就先对这些数排序，然后从最小值开始把它们加起来。

避免等量判断，很多应该相等的浮点数并一定相等。先确定可接受的精确度范围，然后用布尔函数判断数值是否足够接近。

处理舍入误差问题，由于舍入误差而导致的错误与由于数字之间数量级差太大而导致的错误并无二致。换用精确度更高的变量类型；换用二进制编码的十进制表示；把浮点变量变成整型变量；

检查语言和函数库对特定数据类型的支持，包含了像Currency这样的数据类型，专门处理对舍入敏感的数据。

## 字符和字符串

避免使用神秘字符和神秘字符串，神秘字符是指程序中随处可见的字面形式表示的字符串。具名常量或全局变量取代。

1、对于程序的名字，命令名称，报表标题等常常出现的字符串，有时可能需要修改它们的内容。

2、国际市场的重要意义正在日益突现，翻译存在字符串资源文件中的字符串要比翻译存在代码中的字符串容易得多。

3、字符串的字面表示形式通常都会占用较多的存储空间。嵌入式或其它存储空间非常珍贵的应用中，这一点就必须考虑。

4、字符和字符串的字面表示形式的含义是模糊的。注释或具名常量能够澄清你的意图。

避免off-by-one错误，避免因为读写操作超出了字符末尾而导致的off-by-one错误。

如果你需要支持多种语言，请使用Unicode，对国际字符集提供更为全面的支持。了解你的语言和开发环境是如何支持Unicode的，JAVA中所有的字符串都是Unicode的，C和C++等其它的语言中，处理Unicode需要用到与之相关的一组函数。

在程序生命期中尽早决定国际化/本地化策略，与国际化和本地化相关的事项都是很重要的问题。关键的考虑事项包括，决定是否把所有字符串保存在外部资源里，是否为每一种语言创建单独的版本，或者在运行时确定特定的界面语言。

采用某种一致的字符串类型转换策略，如果你使用了多种字符串类型，有一种常用方法能维护各种字符串类型，那就是在程序中把所有字符串都保存为一种格式，在靠近输入输出操作的位置把字符串转换为其它格式。

## 布尔变量

用布尔变量对程序加以文档说明。把表达式的结果赋给一个变量，从而使得这一判断的含义变得明显。

用布尔变量来简化复杂的判断，需要编写一个复杂的判断时，要尝试好几次才能成功。后期修改会很困难，逻辑变量可以简化这种判断。

## 枚举类型

枚举类型是一种允许用英语来描述某一类对象中的每一个成员的数据类型。枚举通常用在你知道变量的所有可能取值，并且希望把它们用单词表达出来的时候。

用枚举类型提高可读性，特别适用于定义子程序参数。

用枚举类型提高可靠性，枚举类型会使编译器执行比整数和常量更为彻底的类型检查。

用枚举类型简化修改。

将枚举类型作为布尔变量的替换方案。布尔变量往往无法充分表达它所需要表达的含义。

检查非法数值，if或case语句中测试枚举类型时，务必记得检查非法值。

定义出枚举的第一项和最后一项，以便用于循环边界。

把枚举类型的第一个元素留做非法值，声明枚举类型的时候，把第一个值保留为非法值0。

明确定义项目代码编写标准中第一个和最后一个元素的使用规则，并且在使用时保持一致。

警惕给枚举元素明确赋值而带来的失误，有些语言允许对枚举里面的各项元素明确地赋值。

使用全局变量或者类来模拟枚举类型。这些枚举类型会增强你的程序的可读性。

## 具名常量

具名常量很像变量，一旦赋值以后就不能再修改了。使用具名常量是一种将程序参数化的方法，把程序中可能变化的一个方面写为一个参数，当需要对其修改时，只改动一处就可以了。单点控制，让软件真正地软了许多，用起来和改起来都很方便。

数据声明中使用具名常量，提高程序的可读性和可维护性。任何一种能够对可能发生改变的失去进行集中控制的技术，都是减少维护工作量的好技术。

避免使用文字量，即使是安全的。

用具有适当作用域的变量或类来模拟具名常量。

统一地使用具名常量。

## 数组

数组是最简单和最常用的结构化数据类型。有些语言里，数组是唯一的结构化数据类型。

确认所有的数组下标都没有超出数组的边界。

考虑用容器来取代数组，或者将数组作为顺序化结构来处理。

检查数组的边界点，通过检查数组的边界点来捕获很多错误。

如果数组是多维的，确认下标的使用顺序是正确的。防止下标串话。

## 创建你自己的类型

程序员自定义的数据类型是语言所能赋予你的一种最强有力的，最有助于澄清你对程序的理解的功能之一。

创建自定义数据类型的指导原则：

给所创建的类型取功能导向的名字。

避免使用预定义类型。

不要重定义一个预定义的类型。

定义替代类型以便于移植。

考虑创建一个类而不是使用typedef。简单的typedef对隐藏变量的底层类型信息有很大帮助，然而，可能需要定义类所能获得的那些额外的灵活度和控制力。

## 要点

使用特定的数据类型就意味着要记住适用于各个类型的很多独立的原则。本章的核对表来确认你已经对常见问题做了考虑。

如果你的语言支持，创建自定义类型会使得你的程序更易于修改，并更具有自描述性。

当你用typedef或者其等级方式创建了一个简单类型的时候，考虑是否更应该创建一个新的类。









