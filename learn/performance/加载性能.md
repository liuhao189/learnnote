# 测量性能

优化的第一步是测量当前的性能，并分析出我们可以在哪些方面改善性能。

## Lighthouse

Lighthouse会审查加载性能，可访问性，PWA等方面。

Lighthouse可以在命令行，Chrome扩展，NodeModule中使用。

Lighthouse在Chrome Devtools中的Audit中可以直接访问。

## 文本内容

文本内容包括，HTML、CSS和JS代码。

### Seperate Development from Deployment

部署代码可以体积小，不易读。发布之前使用压缩工具。

### 压缩代码

去掉多余的字符，空格等，可以减少不少体积。

### 压缩传输内容

Gzip比较出名。Gzip比较擅长于压缩文本内容，文本内容压缩率最高可达70%。不擅长于压缩非文本内容，非文本内容几乎无显著的体积减少。

### 减少类库使用

如果你只使用了类库中的部分功能，你可以通过书写用到的部分方法或CSS规则来降低下载时间。

## 图片内容

### 删除未使用的图片

是否真的需要图片在网页加载时显示。

### 选择合适的图片类型

png使用于剪贴画，绘图，需要透明度的场景。

JPG用于照片。

GIF用于动态图片。

WEBP用于新式浏览器。

### 删除metadata

metadata存在于大多数图片中，包括相机参数，时间戳，相机拍照设置，文件类型，经纬度等信息。

### 缩略图

根据渲染的大小展示缩略图，只在发生特定事件时，才请求大图。

### 降低图片质量

降低图片质量可以在无肉眼可见的差距下，大幅降低文件体积。

### 压缩图片

PNG和JPG图片可以被进一步压缩，免费网站https://tinypng.com。


## HTTP请求

降低请求次数。

### 合并文本资源

合并文本资源内容来降低请求次数，提高加载速度。

### 合并图形图像

合并小图到一张物理图片，然后使用CSS的背景属性来展示图片。

### 警告

在HTTP/2协议下，减少HTTP请求可能达不到理想的效果。

### JS的位置和内联

JS位置放在body的闭合标签之前，这允许浏览器在下载JS之前渲染网页内容。

如果JS要变更初始的内容或DOM，或者提供渲染期间的方法，这些JS必须放置在head中。

简短的关键性的JS最好内联在HTML中。

## HTTP缓存

缓存可以极大提高再次访问的加载性能。

### 开启缓存

根据变化频率来决定缓存时间策略。

### Cache Headers

cache-control和expires。

cache-control:no-cache,可以缓存，但是必须二次验证。

cache-control:no-store,不可以缓存，用于敏感数据或变化频繁数据。

cache-control:public,可以被客户端或任何中间服务器缓存。

cache-control:private, 可以被客户端缓存，不能被中间服务器缓存。

cache-control:max-age, 最长一年，单位为秒，过期时间。

## Speed Tools

### 错误观点

1、用户体验可以被一个单一指标度量。根据页面不同，不同的指标。

2、用户体验可以被特定用户度量。结合实验室数据和各种类型用户性能分析来度量。

3、Lab Data，可控的环境，可复现结果。帮助调试，解决性能问题。

4、Field Data，Real User Monitoring or RUM。


### 工具的作用

帮助开发者了解网站的性能，并给出建议。应用建议时提供详细的调试功能。

## 了解低带宽和高延迟

您需要了解应用或网站在连接不佳或不可靠时的使用情况，并相应地进行构建。

Chrome DevTools可自定义上传/下载和往返时间测试网站。

### 设备模拟

安卓设备可以使用设备模拟器来控制网速和延迟。IPhone可以使用Network Link Conditioner.

### 使用不同位置和网络测试

WebPageTest是一种在线服务，让您的网站能以各种网络和主机位置进行性能测试。

Fiddler支持通过GeoEdge进行全局代理，并且可以使用其自定义规则来模拟调制解调器的速度。

Charles带来可用来调节宽带和延迟。商业软件，但提供有免费试用版。







