# 布局与风格

计算机编程的美学话题，程序源代码的布局。编排出色的代码会带来视觉上和思维上的愉悦，而精细雕琢代码，使之达到美观的程序员们，会从这一过程得到艺术上的满足。

并不会影响执行速度，内存使用量等方面的程序性能，但它却让你日后理解代码，检查代码以及修改代码变得更容易，也使得其它人在你缺位的时候更容易阅读，理解和修改你的代码。

合作项目，请让团队的人阅读本章内容，并在开始编码之前统一大家的风格。

# 基本原则

1、布局的极端情况，缺乏合理的布局。布局显得拥挤，没有为子程序的逻辑组织提供有益的提示。空白的使用仅仅是有助于人的阅读。

2、格式化的基本原理，好的布局凸显程序的逻辑结构。

3、人和计算机对程序的解读，布局是关于程序结构的有用暗示，计算机可能只关心花括号或begin/end。好布局方案的关键是能使程序的外观与逻辑结构相符。

4、好布局有什么用？编程工作量的一小部分是写让机器读的程序，大部分工作是写能让他人看懂的程序。

高手的记性并非天生优于新手，但高手具备某种知识结构，这些结构有助于高手记住特定种类的信息。结构能帮助高手去感知，理解和记住程序的重要特性。

# 把布局作为一种信仰

# 良好布局的目标

1、准确表现代码的逻辑结构，好的布局主要是为了展现代码的逻辑结构。

2、始终如一地表现代码的逻辑结构，好的风格能够适应大多数情况。

3、改善可读性，好的布局方案就该增强代码的可读性。

4、经得起修改，修改某行时不必连带修改其它行的代码。

# 如何将布局目标付诸实施

基于这些准则作为讨论布局的基础，这样喜欢某种布局而不是另一种的主观理由就能说得很清楚。采取不同的方法来衡量这些准则，结论或许会有些不同。

# 布局技术

## 空白

空白能够增强可读性，空白包括空格，制表符，换行，空行，是展现程序结构的主要手段。

分组，空白也是分组，也是确保相关的语句成组放在一起。

空行，将不相关的语句分隔开也是很有必要。各自划分成段落，分开各子程序，突出注释部分。

缩进，请用缩进形式显示程序的逻辑结构。已经证实缩进确能提高程序员的理解能力。两到四个空格最得当。

## 括号

括号应该用的比你觉得需要的更多，对包含两个以上的项的表达式，应该用括号去澄清之。

# 布局风格

多数布局问题都涉及到块结构，跟在控制语句后面的那些语句组。块结构被花括号或关键字括起来。

## 纯块模式

一个设计精良的语言的块结构非常清晰，适于一种自然而然的缩进风格。各个控制结构都有自己的结束符，代码分块是很自然的事。

## 模仿纯块结构

如果所用的语言不支持纯块结构，那么一个好的办法是，将关键字begin和end看成是所在控制结构的扩展。

控制结构以语句A开头，以语句D收尾，begin应该放在语句A的后面，end是语句D。

这种对齐风格很好用，美观大方，可以一致地采用，可维护性也好。

## 使用begin-end对指定块边界

begin-end来泛指begin-end对，花括号，以及类似的语言结构。符合格式化的基本原理，唯一不足时无法精确适用于C++和Java中的switch/case语句。

## 行尾布局

行尾布局，一大组代码缩进至行中间或结尾的布局策略。行尾缩进用来将代码块与作为该快开始的关键字对齐，使子程序的其余参数以第一个参数对齐。

如果代码有所修改，行尾风格就要求相关的多条语句也调整缩进。从而产生维护性问题。

## 哪种风格最优

所有风格都不绝对可靠，都偶尔需要进行合理而明显地折中。

# 控制结构的布局

有些程序元素的布局主要牵涉美观问题，然而，控制结构的布局却会影响可读性和可理解性，故而实践中应优先考虑之。

## 格式化控制结构点的要点

1、不用用未缩进的begin-end块。

2、别让begin和end两次缩进。人们对缩进一次的程序和缩进两次的程序理解并无区别。语句有两三层的嵌套，那么量词缩进会使代码有四或六级缩进，导致布局看起来比实际代码复杂多了。

## 其它考虑

段落之间要使用空行，有些代码没有用begin-end对界定。用空行将它们各自分开。如果有一组语句并不需按某种特定的顺序执行，促使你更加努力地去把哪些语句应属于一组的事情想清楚。

单语句代码块的格式要前后统一，单语句代码块就是控制结构后面只有一条语句。

对于复杂的表达式，将条件分隔放在几行上，将一个赋值表达式的各个部分放在各自的一行里。

不用goto，goto会让程序的正确性验证变得很困难。

case语句不要有行尾布局的例外，行尾布局的风险之一就是case语句的格式化。

# 单条语句的布局

1、语句长度，语句长度应限制在80个字符串以内。现在，偶尔超过80个字符串也没多大关系。

2、用空格使语句显得清楚，使用空格会让逻辑表达式更易读。

3、使用空格让数组引用更容易读。

4、使用空格让子程序参数更易读。参数位置对所有主要的过程语言都是很重要的，很常见的做法是将程序说明放在半个屏幕，而其调用位于另半个屏幕，以便对照形参和实参。

5、格式化后续行，使后续行明显，断句最简单的方法是将第一行部分做成若其单独时就有明显语法错误的样子。

6、把紧密关联的元素放在一起。

7、将子程序调用的后续行按标准量缩进。

8、让续行的结尾易于发现。每个参数占一行，最后用右括号括起来以示参数结束。该方法要占用大量篇幅。

9、将控制语句的后续行缩进以标准的空格数。

10、不要将赋值语句按等号对齐。对赋值语句的后续行按标准量缩进。

## 每行仅写一条语句

每个语句单独置于一行，能够提供有关程序复杂性的准确观点。

对于现代编译器，将多个语句放在一行不能提供任何优化线索。

各语句单独占一行，代码仅需自上而下阅读，而不自上而下，还要从左往右。

编译器以行号指出某行有错误时，你将更容易找出语法错误。基于行的调试器就容易单独地执行代码。

编辑单个语句更容易，删除一行或临时将某行改为注释。

不要让一行代码多个操作副作用，语句除了主要结果之外还要其它效用。

## 数据声明的布局

每行只声明一个数据，容易在声明旁添加注释，每个声明自成一体也便于修改，只需按列查找而不必通读每一行，编译器只给错误行号，定位并改正语法错误也方便了。

变量声明应尽量接近其首次使用的位置。比起变量集中声明，将变量在其首次使用的附近位置声明是更好的风格，减少了跨度和生存期，便于必要时将代码重构为更小的子程序。

合理组织声明顺序，声明按类型分组，由于同类型的变量常在相关操作中使用，按类型分组往往合乎情理。

声明指针变量时请把星号*靠近变量名，或者是去声明指针类型。最好的办法是先声明指针类型名，再用类型名来声明变量。

# 注释的布局

注释做得好可大大增加程序的可读性，而槽糕的注释却会帮倒忙。

1、注释的缩进要与相应代码一致，缩进效果是理解程序逻辑结构的辅助工具，好的注释不会妨碍缩进效果。有注释未必就是好事，可能由于它们干扰了对程序的扫视。

2、每行注释用至少一个空行分开，如果有人想对你的程序有总体认识，最有效的办法是看你的注释而非代码。将注释用空行分开有利于读者扫视代码。

# 子程序的布局

子程序由一些独立的语句，数据，控制结构，注释组成。

1、用空行分隔子程序的各部分，子程序的头，数据和常量名声明以及子程序体之间插入空行。

2、将子程序的参数按标准缩进，任意布局，行尾布局或标准缩进。标准缩进更准确，连贯，可读，易维护。

# 类的布局

类代码的布局原则，第一小节描述如何布局类接口，第二小节阐释怎样编排类实现，最后一小节讨论文件与程序的布局。

## 类接口的布局

1、说明类及其完整用法的头部注释。

2、构造函数与析构函数

3、public子程序

4、protected子程序

5、private子程序和数据成员

## 类实现的布局

1、描述类所在文件之内容的头部注释。

2、类数据

3、public子程序

4、protected子程序

5、private子程序

1、如果文件包含多个类，要清楚地标出每一个类。相关子程序应分组放到类中。不要在类里过度注释，如果对每个子程序都做标记，找特定内容会很困难。除非有充足理由，否则请在一个文件里只放一个类。

## 文件和程序布局

1、一个文件应只有一个类，如果所用语言允许的话，一个文件应该是支持且仅支持一项目的一组子程序的集合。

2、文件的命名应与类名有关，多数项目的类名和文件名之间具有一一对应的关系。

3、在文件中清晰地分隔各子程序，至少用两个空行将各子程序分开。

# 要点

可视化布局的首要任务是指明代码的逻辑组织，评估该任务是否实现的指标包括准确性，一致性，易读性和易维护性。

外部悦目比起其他指标是最不重要的，如果其他指标都达到了，代码又质量好，布局效果看上去也会不错。

VB具有纯代码块风格，Java的传统做法就是使用纯块风格，若使用这些语言编程，请使用纯代码块风格。C++中，模拟纯代码块或者begin-end块边界都行之有效。

结构化代码有其自身目的，始终如一地沿用某个习惯而少来创新，不能持久的不当规范只会损害可读性。

布局的很多方面涉及信仰问题，试着将客观需要和主观偏好区分开来，定出明确的指标，再此基础上再讨论风格参数的选择。

