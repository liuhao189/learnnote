# 协同构建

所有的协同构建技术都试图通过这样或那样的途径，将展示你工作的过程正式化，以便把错误暴露出来。

# 协同开发实践概要

协同构建包括结对编程，正式检查，非正式技术复查，文档阅读，以及其它让开发人员共同承担创建代码及其它工作产品责任的技术。

各种协同构建技术之间尽管存在着一些差异，但它们都基于一个相同的思想，那就是在工作中开发人员总会对某些错误视而不见，而其它人不会有相同的盲点，所以开发人员让其它人来检查工作是很有好处的。

## 协同构建时其它质量保证技术的补充

协同构建的首要目的是改善软件的质量。全程采用结对编程的成本可能比单人开发要高大约25%，但开发周期大概会缩短45%。大大超越单人开发的效率。

协同开发不但在捕获错误方面比测试的效能更高，所能发现的错误类型也不同于测试，由人进行的复查能够发现不明显的错误信息，不恰当的注释、硬编码的变量值，以及重复出现的需要进行统一的代码模式，这些是测试发现不了的。

协同开发的另一个作用是让人们意识到他们的工作会被复查，他们会小心谨慎地检查自己的工作。

## 协同构建有利于传授公司文化以及编程专业知识

复查是一种很重要的机制，它可以让程序员得到关于他们自己代码的反馈。代码，标准以及让代码符合标准的理由等，都是复查讨论中的好主题。

除了得到他们是否很好地遵循了标准的反馈之外，还需要得到程序设计主管方面的回馈，格式，注释，变量名，局部变量和全局变量的使用，设计方法以及这里采用的解决方法。

复查为这两种人提供了一个技术交流的平台，无论未来还是现在，复查都是培养新人以提高其代码质量的好机会。

一个采用正式检查的团队称，复查可以快速地将所有开发者的水平提升到最优秀的开发者的高度。

## 集体所有权适用于所有形式的协同构建

所有的代码都属于团队而不是某一个人，并且团队中的所有成员都可以对其进行访问和修改。

众多双眼睛的检查，以及众多程序员的协力编写，可以使代码的质量变得更好；某个人离开项目所造成的影响更小了，总体上缺陷修正周期变短了，一人有空，随时被指派去修正缺陷。

## 在构建前后都应保持协作

有关协同构建的思想同样适用于评估、计划、需求、架构、测试以及维护等阶段。

# 结对编程

一位程序员敲代码，另外一位注意有没有出现错误，并考虑某些策略性的问题。

## 成功运用结对编程的关键

用编码规范来支持结对编程，应该对风格的进行标准化，以便程序员将精力集中到本质的任务上。

不要让结对编程编全程旁观，不掌握键盘的那个人应该主动参与到编程当中，他应该分析代码，提前思考接下来的代码应该做些什么，对设计进行评估，并对如何测试代码做出计划。

不要强迫在简单的问题上使用结对编程，结对编程来解决最复杂的问题。

有规律地对结对人员和分配的功能任务进行转换，有规律地进行转换有助于知识的互相传播，结对编程的好处在于能够让不同的人熟悉系统的不同部分。

鼓励双方跟上对方的步伐。

确认两个人都能够看到显示器。

不要强迫程序员与自己关系紧张的人组队。个人性格之间的冲突会导致组合的效能出问题。

避免新手组合，至少一人有经验时，结对编程的效果做好。

指定一个组长，指定一个人来协调工作的分配，对结果负责以及负责与项目外其它人联系。

## 结对编程的好处

与单独开发相比，结对能够使人们在压力之下保持更好的状态。结对编程鼓励双方保持代码的高质量。

能够改善代码质量，代码的可读性和可理解性都倾向于上升到团队中最优秀程序员的水平。

缩短进度时间表，结对往往能够更快地编写代码，代码的错误也更少。项目组在项目后期花费的修正缺陷的时间会更少。

它还具有协同构建的其它常见好处，包括传播公司文化，指导初级程序员，以及培养集体归属感。

# 正式检查

正式检查是一种特殊的复查，它在侦测缺陷方面特别有效，并且相对测试来说更加经济合理。任何复查都涉及阅读设计或者代码。

## 你期望详查能够带来什么结果

独立的详查通常能够捕捉到60%的缺陷，这比除了原型和大规模beta测试之外的其它技术都要好。设计和代码的联合详查通常能够去除产品中的70%到85%，甚至是更多的缺陷。

详查还可以用来评估进度，只是技术层面的进度。

## 详查中的人员角色

详查的一个关键特征就是每个人都要扮演某一个明确的角色。

主持人，主持人负责保证详查以特定的速度进行，使其既能保证效率，又能发现尽可能多的错误。负责管理详查的其它方面，分配复查设计和代码的任务，分发详查所需的核对表，预定会议室，报告详查结果，以及跟踪详查会议上指派的任务。

作者，直接参与设计或者代码的人，扮演相对次要的角色。详查的目标之一就是让设计或者代码本身能够表达自己。
陈述项目的概况，为详查会议做准备，作者的责任就是解释设计和代码中不清晰的部分，偶尔还需要解释那些看起来好像有错的地方为什么实际上是可以接受的。

评论员，评论员是同设计和代码有直接关系，但又不是作者的人。实现这个设计的程序员，测试人员或者高层架构师也可以参与。找出缺陷。

记录员，记录员将详查会议期间发现的错误，以及指派的任务记录下来。

经理，纯技术性的复查，准备一份详细报告让经理了解情况。

## 详查一般步骤

计划，作者将设计或者代码提交给主持人，而主持人则决定哪些人复查这些材料，并决定会议在什么时候什么地点召开。

概述，作者花一个小时来描述一下这些设计或代码的技术背景。设计或代码本身应该可以自我表达，在概述中不应谈论它们。

准备，每一个评论员独立地对设计或者代码进行详查，找出其中的错误，使用核对表来记录和指导他们对材料的详查。每一个评论员可以被赋予某一特定视角，详查会更有效。或者对每一个评论员赋予一个以上的待详查场景，场景可以涉及一些特定的问题，评论员需要回答它们。

详查会议，主持人挑选出除作者之外的某个人来阐述涉设计或者阅读代码。所有的逻辑都应当解释，包括每个逻辑结构的每个分支。不要在开会的过程当做讨论解决方案，小组应当把注意力保持在识别缺陷上。

详查报告，主持人要写出一份详查报告，列出每一个缺陷，包括它的类型和严重级别。详查报告有助于确保所有的缺陷都将得到修正，它还可以用来开发一份核对表。可以用客观数据来应对有关详查效率的质询。新的方法论都需要事实来证明它存在的必要性。

返工，主持人将缺陷分配给某人来修复，得到任务的人负责修正列表中的每个缺陷。

跟进，主持人负责监督在详查过程中分配的返工任务。根据发现错误的数量和严重级别，可以让评论员重新详查整个工作结果，或者让评论员只重新详查修复的部分，或允许作者完成修改而不做任何跟进。

第三个小时的会议，在正式检查结束之后讨论解决方案。

## 对详查进行细调

去掉或合并某些步骤往往是增加而不是降低了成本。对流程进行定量分析，并且清楚地知道改变之后的方法比这里所描述的方法更有利于你的工作，那就放心去做吧。

只要做过详查，你就会注意到某些类型的错误比其它类型的错误更容易出现。需要建立一个核对表，让人对那些常见错误保持警惕。提供一些线索，帮助弄清程序员需要在哪些麻烦领域中得到更多的训练和支持。

## 详查中的自尊心

进行详查的目的是发现设计或者代码中的缺陷，而不是探索替代方案，或者争论谁对谁错，其目的绝不应该是批评作者的设计或代码。

作者应该承认每一个所谓的缺陷，然后继续详查，承认一个批评并不意味着作者认同批评的内容。在复查工作中，不要试图辩护，复查之后，可以对每一个问题进行思考，判断它是否真的是一个缺陷。

评论员应该享受寻找缺陷的乐趣，但每一个评论员必须尊重作者决定如何解决某个错误的最终权利。

## 详查总结

用于详查的核对表有助于集中注意力，由于详查有标准的核对表和标准的角色，因此它是一个系统化过程。同时它可以自我优化的，因为它采用一个正式的反馈循环来改进核对表，并跟踪准备和详查的速度。在这种全程控制和持续优化的努力下，无论刚开始的时候状况如何，详查都很快就能成为一种非常强大的技术。

这一过程是系统化的和可重复的，并且使用了量化的反馈方法来自我改进。

# 其它类型的协同开发实践

走查，会涉及两个或者更多的人，进行设计或者代码的相关讨论。需要复查的设计或者代码的作者举行和主持；焦点在技术事宜上；所有参与者通过阅读设计或代码来进行准备，并从中找出错误；高级程序员向一个新手们传授经验与写作精神的机会；持续一个小时；重点在于检测错误，而非修正它们。

## 你期望走查能够得到什么样的结果

聪明的，有纪律地进行走查，可以得到与正式检查相类似的结果。

## 代码阅读

代码阅读是详查和走查的另一种替代方案。直接阅读代码并从中找出错误，同时你也从质量的角度对代码做出评价，代码的设计、风格、可读性、可维护性以及效率等。

代码阅读更多地关注对代码进行的独立复查，而不是关注会议本身。会议上，每个人只在部分时间做共享，很大一部分精力用于保持团队的活力。会议通常不得不被推迟少许时间，直到所有人都有两个小时的时间来开会。

## 公开演示

公开演示是向客户展示软件产品的另一种复查形式。项目合约通常规定需要为需求、设计以及代码召开复查会议。目的是向客户证明项目一切顺利，管理层的复查，不是技术复查。

## 协同构建技术的比较

结对编程和正式检查在品质，成本以及进度方面能够产生类似的结果，在这两者之间进行选择与其说是技术性问题，还不如说是个人风格问题。

## 要点

协同开发实践往往能比测试发现更多的缺陷，并且更有效率。

协同开发实践所发现错误的类型通常跟测试所发现的不同，这意味着你需要同时使用详查和测试来保证你软件的质量。

正式检查通过运用核对表，准备工作，明确定义的角色以及对方法的持续改善，将缺陷侦测的效率提升至最高。往往比走查发现更多的缺陷。

通常，结对编程拥有和详查相同的成本，并能产生质量相当的代码。需要缩短开发周期的时候，结对编程就非常有价值。相对于单独工作来说，有些开发人员更喜欢结对工作。

正式检查可以应用在除代码之外的很多工作成果上，例如需求，设计以及测试用例。

走查和代码阅读也是详查的提点方案，代码阅读更附有弹性，能有效地利用每个人的时间。
