# 优化内容效率

网络应用在范围、目标和功能上都在不断增长。向着更丰富网络这一目标高歌猛进。每个应用下载的数据量都在持续稳步增长。

我们通常需要获取几十个有时甚至是几百个不同的资源，所有这些资源加起来的数据量高达几兆字节，并且必须在短短几百毫秒内汇聚起来，以实现我们想要达到的即时网络体验。

优化内容效率的重要就在此。一般通过以下方式：1、避免不必要的下载；2、通过各种压缩技术优化每个资源的传送编码以及尽可能利用缓存来避免多余的下载。

## 避免不必要的下载

1、清点您的网页上的自有资产和第三方资产。

2、评估每个资产的价值，其价值及技术性能。

3、确定这些资源是否提供了足够的价值。

## 优化基于文本的内容的编码和传送大小

除了避免不必要的资源下载，在提高网页加载速度上您可以采取的最有效措施就是，通过优化和压缩其余资源来最大限度减少总下载大小。


## 数据压缩基础知识

1、压缩就是使用更少的位对信息进行编码的过程。

2、消除不必要的数据总是会产生最好的结果。

3、有许多种不同的压缩技术和算法。

4、需要利用各种技术来实现最佳压缩。

预处理、环境特定优化以及为不同的内容采用不同的算法。

### 源码压缩：预处理和环境特定优化

压缩冗余或不必要数据的最佳方法是将其全部消除。在某些环境下，可能对数据格式及其属性有内容特定了解，往往可以在不影响其实际含义的情况下显著减小负载的大小。

### 通过GZIP压缩文本

1、GZIP对基于文本的资产的压缩效果最好：CSS，JS和HTML。

2、所有现代浏览器都支持GZIP，并且会自动请求该压缩。

3、服务器必须配置为启用GZIP压缩，某些CDN需要特别注意以确保GZIP已启用。

GZIP是一种可以作用于任何字节流的通用压缩程序，它会在后台记忆一些之前看到的内容，并尝试以高效方式查找并替换重复的数据片段。

对已经通过替代算法压缩过的资产运行GZIP，则效果甚微，甚至毫无效果。

### GZIP原理

RFC1952是GZIP file format speification version 4.3。该规范主要定义了GZIP压缩在数据格式方面的规范。

#### 压缩核心之Deflate

GZIP的核心shiDeflate，在RFC9151中被标准化。是一个同时使用LZ77与Huffman Coding的算法。

#### LZ77

LZ77的核心思路是如果一个串中有两个重复的串，那么只需要指导第一个串的内容和后门串相对于第一个串起始位置的距离+串的长度。

LZ77使用滑动窗口来实现这个算法，扫描头从串的头部开始扫描串，在扫描头的前面有一个长度为N的滑动窗口。

LZ77要在窗口里寻找重复串相对来说效率是比较低的。解压时，每个小串前都有一个标识要标记原始串还是替换串，通过这个标识就能以O(1)的复杂度直接读完并且替换完替换串，整体上效率是非常可观的。

#### Huffman Coding

核心思路是通过构造Huffman tree的方式给字符重新编码，保证出现频率越高的字符占用的字节越少。

Huffman Coding之后需要维护一张Huffman Map表，来记录重新编码后的字符串，根据这张表，还原原始串也是非常高效的。

## 图像优化

