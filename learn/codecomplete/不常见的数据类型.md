# 不常见的数据类型

## 结构体

结构体这一术语指的是使用其它类型组成的数据。类有时表现得也想结构体一样，当类完全由公用的数据成员组成，而不包含公用子程序的时候。

用结构体来明确数据关系，结构体把相关联的一组数据项聚集在一起。

用结构化简化对数据块的操作，对结构体执行操作要比对各个元素执行同样的操作容易更多。

用结构体简化参数列表，可以利用结构体变量简化子程序的参数列表。与信息应该按照有必要了解的原则进行传递。

用结构体来减少维护。结构化数据所带来的最大好处体现在哪些与title字段没有逻辑关系的代码段里。

## 指针

指针的使用是现代编程中最容易出错的领域之一。以至于像Java，C#和Visual Basic这些现代语言都没有提供指针数据类型。
很好地理解指针也会有助于你理解你的编程语言是如何工作的。

### 理解指针的范例

从概念上看，每一个指针都包含两个部分：内存中的某处位置，以及如何解释该位置的内容。

内存中的位置，内存中的一个位置就是一个地址。常用16进制形式表示。指针本身只包含这个地址。为了使用该指针所指向的数据，就必须访问该地址。解释该位置的内存内容，才能使它变得有意义。

如何解释内存中某个位置的内容，是由指针的基类型决定的。

### 使用指针的一般技巧

指针错误都产生于指针执行了它不应该指向的位置。把指针操作限制在子程序或者类里面。同时声明和定义指针。在与指针分配相同的作用域中删除指针。在使用指针之前检查指针。先检查指针所引用的变量再使用它。用狗牌字段来检测损毁的内存。

增加明显的冗余，用额外的指针变量来提高代码清晰。简化复杂的指针表达式。画一个图。按照正确的顺序删除链表中的指针。分配一片保留的内存后备区域。粉碎垃圾数据。在删除或者释放指针之后把它们设为空值。在删除变量周期爱你检查非法指针。跟踪指针分配情况。编写覆盖子程序，集中实现避免指针问题的策略。采用非指针的技术。

## 全局数据

全局数据可以在程序中任一一个位置访问。这一概念有时被延伸到作用域比局部变量更广的变量。使用全局数据的风险比使用局部数据大，通过一些子程序来访问数据很有帮助。

### 常见问题

你随意使用全局数据，认为不能随心所欲地使用它们是一种约束，那么你可能还没有充分理解信息隐藏和模块化的意义。模块化，信息隐藏并集合使用设计良好的类可极大地提升大型程序的可理解性和可维护性。努力去写出与全局变量和外界联系尽可能少的子程序和类来。

无意间修改了全局数据，这种问题成为副作用。

与全局数据有关的奇异的和别名问题。

与全局数据有关的代码重入问题，多线程访问问题，全局数据将不但在多个子程序之间共享，而且也将在同一个程序的不同拷贝之间共享。

全局数据阻碍代码重用，全局数据是运行环境的一部分。

与全局数据有关的非确定的初始化顺序。有些语言，没有定义不同的转译单元里的数据初始化顺序。

全局数据破坏了模块化和智力上的可管理性。超过几百行代码的程序的核心便是管理复杂度，你能够在智力上管理一个大型程序的唯一方法就是把它拆分成几个部分。

## 使用全局数据的理由

存在于数据库中的数据是全局数据，存在于配置文件如windows注册表中的数据也是，具名常量也是全局数据，只不过不是全局变量而已。

保存全局数值，一些在概念上用于整个程序的数据，可能是一个用于表示程序状态的变量。

模拟具名常量，模拟枚举类型。

简化对其常用的数据的使用，会大量地引用一个变量，以致于它几乎出现你所编写的每一个子程序的参数列表里。不如把它设置成全局变量。

消除流浪数据，有的时候把数据传递给一个子程序或类，想把它传递给另一个子程序或类。

### 只有万不得已时才使用全局数据

首先把每一个变量设置为局部的，仅当需要时才把变量设置为全局的。

区分全局变量和类变量，只在一组子程序里被频繁使用的实际是类变量。

使用访问器子程序，避免产生与全局数据相关问题的主要方法。

### 用访问器子程序来取代全局数据

使用访问器子程序来集中控制你的数据，并保护你免受变化的困扰。

获得了对数据的集中控制。

可以确保对变量的所有引用都得到了保护。

可以自动获得信息隐藏的普遍益处，修改一个访问器子程序的内部代码而无需涉及程序的其余部分。

访问器子程序可以很容易地转变为抽象数据类。

### 如何使用访问器子程序

把数据隐藏到类里面，用static关键字或者它的等价物来声明该数据，以确保只存在该数据的单一实例。写出可以查看并且修改该数据的子程序。要求类外部的代码使用该访问器子程序来访问该数据，而不是直接操作它。

要求所有的代码通过访问器子程序来存取数据。

不要把你所有的全局数据都扔在一处。

用锁定来控制对全局变量的访问，锁定要求在使用或者更新一个全局变量值之前，该变量必须被签出，在用完这一变量之后再把它签入获取。

在你的访问器子程序构建一个抽象层，问题域这一层次上构建访问器子程序，而不是在细节实现层次上。

使得对一项数据的所有访问都发生在同一个抽象层上。

### 如何降低使用全局数据的风险

许多情况下，全局数据事实上是没有设计好或没有实现好的类中的数据。极少情况下，一些数据的确需要作为全局数据，但是可以使用访问器子程序对其进行封装，从而最大限度地减少发生问题的可能性。

创建一种命名规则来突出全局数据，在对全局变量进行操作时，为全局变量命以更醒目的名字可以让你少犯错误。

为全部的全局变量创建一份注释良好的清单。

不要用全局变量来存放中间结果。

不要把所有的数据放在一个大对象中并到处传递，以说明你没有使用全局变量。

## 要点

结构体可以使得程序更简单，更容易理解，以及更容易维护。

每当你打算使用结构体的时候，考虑采用类是不是会工作得更好。

指针很容易出错，用访问器子程序或类以及防御式编程实践来保护自己的代码。

避免用全局变量，不只是因为它们很危险，还是因为你可以用其它更好的方法来取代它们。

不得不使用全局变量，通过访问器子程序来使用它。



